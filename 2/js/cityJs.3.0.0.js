define(function(t,e,a){function l(t){var e={toT:0,durTime:500,delay:30,callback:null},i=$.extend(e,t),a=null,l=this,n=l.scrollTop(),s=i.toT-n,o=0;i.durTime=Math.sqrt(Math.abs(s/1e3))/2,i.durTime=i.durTime<1?1:i.durTime,i.durTime=500*i.durTime;var r=Math.round(i.durTime/i.delay),c=function(t){o++;var e=Math.round(s/r);return o>=r?(l.scrollTop(t),window.clearInterval(a),void(i.callback&&"function"==typeof i.callback&&i.callback())):void l.scrollTop(n+o*e)};return a=window.setInterval(function(){c(i.toT)},i.delay),l}function n(t){for(var e=[],i=0;i<t.length;i++){var a=t[i],l=[],n=JSON.parse(a.allCitys);n=n.tagList;for(var s=0;s<n.length;s++)for(var o=n[s].cityList,r=0;r<o.length;r++)o[r].extend&&o[r].extend.id?o[r].id=o[r].extend.id:o[r].id=o[r].extend,l.push(o[r]);e.push(l)}return e}function s(t){for(var e=[],i=0;i<t.length;i++){var a=t[i],l=[];if(a.headerCitys){var n=JSON.parse(a.headerCitys);n=n.tagList;for(var s=0;s<n.length;s++){var o={},r=[];o.title=n[s].title,o.cellType=n[s].cellType;for(var c=n[s].cityList,h=0;h<c.length;h++)c[h].extend&&c[h].extend.id&&(c[h].id=c[h].extend.id),r.push(c[h]);o.citylist=r,l.push(o)}e.push(l)}else e.push(l)}return e}!function(){var t='.search{padding:8px 65px 8px 8px;background-color:#e0e4ec;position:relative;width:100%;box-sizing:border-box;z-index:10}.search-reset{padding-right:8px}.city-panel,.search{-webkit-user-select:none;-webkit-tap-highlight-color:rgba(255,255,255,0);-webkit-user-drag:none}.search input{display:block;width:100%;height:40px;padding-left:36px;border-radius:5px;box-sizing:border-box;font-size:14px;border:1px solid #dcdcdc}.search .clear{position:absolute;right:65px;top:8px;height:20px;padding:10px}.search-reset .clear{right:8px;display:none}.search .clear i{display:block;width:21px;height:21px;background:#ccc;border-radius:50%;line-height:20px;font-size:20px;color:#fff;text-align:center;font-style:normal}.search .cancel{position:absolute;width:65px;height:40px;top:8px;right:0;text-align:center;font-size:18px;line-height:40px}.search-complete,.search-reset .cancel{display:none}.search .search-icon{position:absolute;left:18px;top:20px;width:12px;height:12px;border:1px solid #999;border-radius:50%}.search .search-icon:after{content:"";position:absolute;width:1px;height:8px;left:13px;top:10px;background:#999;-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.search-complete .autofill-wrap{border:none}.search-complete table tr{height:44px;line-height:44px;font-size:14px}.search-complete table tr div{font-family:微软雅黑;font-size:14px}.city-notice,.city-tab{background:#e9ecf1}.city-notice.none,.city-wrapper-content.none{display:none}.city-tab{border-width:1px 0;border-image:url(http://img1.40017.cn/touch/hb/c/2/img/border-dc.png) 2 0 stretch;line-height:40px;color:#666;font-size:15px}.city-tab li{float:left;width:50%;text-align:center;box-sizing:border-box;padding-left:15%}.city-tab li.active{color:#50b400;position:relative}.city-tab li:last-child{padding-left:0;padding-right:15%}.city-tab li.active:after{content:"";position:absolute;left:65%;bottom:0;width:100px;height:2px;background:#50b400;margin-left:-50px}.city-tab li:last-child:after{padding-left:0;left:35%}.city-wrapper{position:relative}.c-wrapper{padding-top:8px;color:#666;position:absolute;top:0;bottom:0;width:100%;overflow:scroll;-webkit-overflow-scrolling:touch}.c-wrapper li,.city-wrapper-content{position:relative}.c-wrapper h3{height:30px;padding-left:20px;line-height:30px;color:#777;font-weight:400}.c-wrapper h3.city-key-dw,.c-wrapper h3.city-key-rm{line-height:33px;height:33px;font-size:12px}.c-wrapper h3.city-key-rm{margin-top:5px}.c-wrapper .city-key:after{content:"";float:right;width:11px;height:11px;border-left:1px solid #bbb;border-top:1px solid #bbb;margin:12px 16px 0 0;-webkit-transform:rotate(-135deg);transform:rotate(-135deg);transition:transform .2s linear;-webkit-transform-origin:3px 3px;transform-origin:3px 3px;transition:-webkit-transform .2s linear}.c-wrapper .city-key.open{color:#50b400}.c-wrapper .city-key.open:after{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.c-wrapper li{height:44px;padding:0 20px;line-height:44px;background:#fff}.c-wrapper .require-key,.c-wrapper .sort-city{border-width:1px 0;border-image:url(http://img1.40017.cn/touch/hb/c/2/img/border-dc.png) 2 0 stretch}.c-wrapper .require-key{border-width:0 0 1px}.c-wrapper .require-city li,.c-wrapper .sort-city li{position:relative;overflow:hidden}.c-wrapper .require-city li:before,.c-wrapper .sort-city li:before{position:absolute;content:"";left:20px;bottom:0;height:1px;width:100%;background-image:linear-gradient(to bottom,transparent 50%,#ddd 50%)}.c-wrapper .require-city li:last-child:before,.c-wrapper .sort-city li:last-child:before{display:none}.c-wrapper li.select{color:#50b400;position:relative}.c-wrapper li.select:after{content:"";position:absolute;width:17px;height:9px;right:45px;top:12px;border-left:4px solid #50b400;border-bottom:4px solid #50b400;-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.c-wrapper .hot-city-ul li.select{border-color:#50b400}.c-wrapper .hot-city-ul li.select:after{display:none}.c-wrapper .dw-city{padding:0 35px 0 15px}.c-wrapper .dw-city li{background:#fff;border:1px solid #ddd;color:#666;font-size:16px;border-radius:3px}.c-wrapper .dw-city li span,.city-nav{color:#999;font-size:12px}.c-wrapper .hot-city-ul{padding:0 0 0 5px}.c-wrapper .block-city li,.c-wrapper .hot-city-ul li{background:#fff;border:1px solid #dcdcdc;border-radius:3px;padding:0 10px;height:32px;line-height:32px}.c-wrapper .hot-city-ul li{min-width:81px;box-sizing:border-box;float:left;margin:0 0 10px 10px;text-align:center}.c-wrapper .block-city li{margin:5px 20px 5px 15px;text-align:left}.c-wrapper .block-city li:after{right:20px;top:8px}.c-wrapper .closed{display:none}.city-nav{position:fixed;right:0;top:62px;color:#50b400;background:rgba(242,244,247,.7);padding-top:5px;-webkit-tap-highlight-color:rgba(255,255,255,0);-webkit-transform:translateZ(0);-webkit-user-select:none;-webkit-user-drag:none}.city-nav.nav-fixed-top{top:100px}.city-nav.hidden,.city-nav.none{display:none}.city-nav li,.city-nav li span{line-height:20px;padding:0 2px;text-align:center;font-size:16px}.city-nav .nav-city-dw,.city-nav .nav-city-rm{font-size:14px}.city-nav li span{position:absolute;right:100%;top:0;background:rgba(80,180,0,.7);font-size:18px;color:#fff;border-radius:2px;white-space:nowrap;padding:3px 6px;display:none}.city-nav .nav-active span{display:block}.city-nav li span:after{content:"";right:-7px;top:50%;margin-top:-4px;border-color:transparent transparent transparent rgba(80,180,0,.7);border-style:dashed dashed dashed solid;border-width:4px;position:absolute}.city-nav li,.search-complete .autofill-wrap{position:relative}@media screen and (width:375px){.c-wrapper .hot-city-ul{padding:0 0 0 11px}.c-wrapper .hot-city-ul li{margin:0 0 10px 4px}}.autofill-wrap{position:absolute;background-color:#fff;font:12px/24px SimSun;width:100%;border:1px solid #ccc}.autofill-close{position:absolute;width:11px;height:11px;top:7px;right:10px;background:url(http://img1.40017.cn/touch/hb/c/2/img/pic.png?v=2) 0 -16px;cursor:pointer}.autofill-hd-inner{color:#999;font-size:12px;padding:0 10px;display:block}.autofill-tray{background:#fff;width:100%}.autofill-tray th{padding:0 10px;border-bottom:1px solid #ddd}.autofill-hd-inner,.autofill-tray td,.autofill-tray th{white-space:nowrap;overflow:hidden}.autofill-tray td{color:#333}.autofill-tray .ltd{text-align:left}.autofill-tray .rtd{text-align:right}.autofill-hover,.item-state-hover td{background-color:#e2e2e2}.autofill-hili{color:#f60;cursor:pointer}.autofill_item{line-height:30px;padding-left:15px;display:block}.autofill_item,.show-title{border-bottom:1px solid #ccc}',e=document.createElement("style");e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e)}(),function(){function t(t){return $.extend(this,{name:"city",hasSearch:!0,placeholder:"中文/拼音/首字母",hasLocation:1,tabName:[],nameAttr:"name",dbList:!1,pyAttr:"fullPy",dataAttrMap:{id:"id",name:"name"},matchAttrs:["name","fullPy","shortPy"],historyCityName:"historyCities",cityFilter:function(t){return!0},hotCityFilter:function(t,e){return t===e[this.nameAttr]},historyCityNumber:5,completeObj:{}},t),o.call(this),"asRequired"===this.mode?void($.isArray(this.hotCities)?(this.hotCitiesReady=!0,h.call(this)):"[object Object]"===Object.prototype.toString.call(this.hotCities)?e.call(this,h):(this.hotCities=[],this.hotCitiesReady=!0,h.call(this))):($.isArray(this.hotCities)?this.hotCitiesReady=!0:"[object Object]"===Object.prototype.toString.call(this.hotCities)?e.call(this,d):(this.hotCities=[],this.hotCitiesReady=!0),void($.isArray(this.cities)?(this.citiesReady=!0,d.call(this),this.select&&$("li[data-"+this.select[0]+'="'+this.select[1]+'"]',this.elem).addClass("select")):n.call(this,d)))}function e(t){var e=this,i=$.extend({},e.hotCities);i.callback=function(i){e.hotCities.callback&&(i=e.hotCities.callback(i)),e.hotCities=i,e.hotCitiesReady=!0,t.call(e)},_tc_bridge_util.get_data(i)}function a(t,e){if(e){var i=t.param.reqbody;i?(i="string"==typeof i?JSON.parse(i):i,t.param.reqbody=$.extend(i,e)):t.param.reqbody=e}}function n(t,e,i){var l=this,n=$.extend({},l.cities),s=n.processData({cityKey:e&&e.attr("data-city-key"),country:i});a(n,s),n.callback=function(i){l.cities.callback&&(i=l.cities.callback(i)),e?t.call(l,i,e):(l.cities=i,l.citiesReady=!0,t.call(l))},_tc_bridge_util.get_data(n)}function s(t,e){for(var i="",a=0,l=t.length;l>a;a++)i+=this.buildCityItem(t[a],"li");e.next().html(i)}function o(){this.elem?this.elem=$(this.elem):(this._isCreateElem=!0,window._fedRouter&&window._fedRouter.appendRouter?(window._fedRouter.appendRouter(this.name),this.elem=$("#"+this.name+"Page").addClass("page")):(this.elem=$('<div id="'+this.name+'Page" class="page"></div>'),this.elem.appendTo($("body"))));var t="";if(this.hasSearch&&(t+='<div style="height:56px;"><div class="search search-reset"><input placeholder="'+this.placeholder+'" /><span class="search-icon"></span><span class="clear" style="display:none"><i>×</i></span><span class="cancel">取消</span></div></div><div class="search-complete"></div>'),this.dbList){t+='<div class="city-notice"><ul class="city-tab clearfix"><li class="active">'+(this.tabName[0]||"国内城市")+"</li><li>"+(this.tabName[1]||"国际城市")+'</li></ul><div class="city-wrapper-content"><div class="city-wrapper c-wrapper "></div></div><div class="city-wrapper-content icity-wrapper-content"><div class="icity-wrapper c-wrapper"></div></div></div>',this.elem.append(t);var e,i=$(".city-notice .city-tab li",this.elem).on("click",function(){var t=$(this),l=i.index(this);e=e||$(".city-nav",this.elem),t.hasClass("active")||(i.removeClass("active"),t.addClass("active"),a.addClass("none"),$(a[l]).removeClass("none"),e.addClass("hidden"),$(e[l]).removeClass("hidden"))}),a=$(".city-notice .city-wrapper-content",this.elem);this.cityPanelCon=a}else t+='<div class="city-notice"><div class="city-wrapper-content"><div class="city-wrapper c-wrapper"></div></div></div>',this.elem.append(t);var l=56;this.dbList&&(l+=40),!this.hideNavbar&&(l+=45);var n=$(window).height()-l;this.allCityCon=$(".city-wrapper-content").css({height:n+"px"})}function r(t){if(!t)return"";for(var e=t,i="",a=[],l=[],n=0;n<e.length;n++){var s=e[n];if(!s.title||!s.citylist.length)break;for(var o=x[s.cellType]||x.grid,r=Math.random().toString().replace(".",""),c=0,h=s.citylist.length;h>c;c++)l.push(this.buildCityItem(s.citylist[c],"li"));l.length&&(i+='<h3 class="city-key-'+r+' city-key-rm">'+s.title+'</h3><ul class=" '+o+'">'+l.join("")+"</ul>",l=[],a.push('<li data-key="'+r+'"  class="nav-city-dw"  >'+s.title+"<span>"+s.title+"</span></li>"))}return[i,a.join("")]}function c(t){if(!t)return"";for(var e=[],i=0;i<t.length;i++){var a=t[i],l=x.grid,n=[],s=a;"[object Object]"===Object.prototype.toString.call(a)&&(l=x[a.cellType]||x.grid,s=a.citylist);for(var o=0,r=s.length;r>o;o++)n.push(this.buildCityItem(s[o],"li"));n.length&&e.push('<h3 class="city-key-rm">'+(a.title||"热门")+'</h3><ul class=" '+l+' clearfix">'+n.join("")+"</ul>")}return e.length?e.join(""):void 0}function h(){if(this.hotCitiesReady){var t=ihtmlStr="";this.hasLocation&&(t+='<h3 class="city-key-dw">当前</h3><ul class="dw-city">'+(1===this.hasLocation?'<li class="disabled"><span>正在获取位置信息</span>':'<li class="disabled get-location"><span>点击获取当前位置</span>')+"</li></ul>");var e=this.hotCities||[];this.dbList?(t+=c.call(this,e[0]),e[1]&&(ihtmlStr+=c.call(this,e[1]))):t+=c.call(this,e),this.letters||(this.letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]);var a,l=this.letters;for(i=0,len=l.length;i<len;i++){a=l[i];var o='<h3 class="city-key require-key" data-city-key="'+a+'">'+a+'</h3><ul class="require-city"></ul>';ihtmlStr+=o,t+=o}$(".city-wrapper",this.elem).html(t),$(".icity-wrapper",this.elem).html(ihtmlStr),1===this.hasLocation&&f.call(this);var r=this;$(".c-wrapper",this.elem).delegate(".city-key","click",function(){var t=$(this);if(t.hasClass("open"))return void t.removeClass("open").next().addClass("closed");$(".open",t.liveFired).removeClass("open").next().addClass("closed"),t.addClass("open");var e=t.next();if(e.hasClass("closed"))return void e.removeClass("closed");var i="gn";r.dbList&&t.parents(".c-wrapper").hasClass("icity-wrapper")&&(i="gw"),n.call(r,s,t,i)}),m.call(this)}}function p(t,e){for(var i=[],a=0,l=t.length;l>a;a++)city=t[a],this.cityFilter(city)&&(this.completeData.push(u.call(this,city)),index=city[this.pyAttr].toUpperCase().charCodeAt(0)-65,void 0===i[index]&&(i[index]=[]),i[index].push(this.buildCityItem(city,"li")),this.getHotCity(city,e));return i}function d(){if(this.hotCitiesReady&&this.citiesReady){var t=this.cities,e=[],a=[],l=[],n=[],s=hotHtmlStr=ihotHtmlStr="";this.completeData=[];var o=["",""],c=[];if(this.dbList)e=p.call(this,t[0],0),a=p.call(this,t[1],1),c=r.call(this,this.hotCities[0]),o=r.call(this,this.hotCities[1]);else{"[object Array]"===Object.prototype.toString.call(t)&&(t=t[0]);var h=this.hotCities;"[object Array]"===Object.prototype.toString.call(h)&&(h=h[0]),e=p.call(this,t),c=r.call(this,h)}hotHtmlStr=c[0],ihotHtmlStr=o[0],ihotHtmlStr&&n.push(o[1]),this.hasLocation&&(s+='<h3 class="city-key-dw">当前</h3><ul class="dw-city">'+(1===this.hasLocation?'<li class="disabled"><span>正在获取位置信息</span>':'<li class="disabled get-location"><span>点击获取当前位置</span>')+"</li></ul>",l.push('<li data-key="dw" class="nav-city-dw">当前<span>当前</span></li>')),hotHtmlStr&&(s+=hotHtmlStr,l.push(c[1]));var d;for(i=65;i<91;i++)d=String.fromCharCode(i),e[i-65]&&(l.push('<li data-key="'+d+'">'+d+"<span>"+d+"</span></li>"),s+='<h3 class="city-key-'+d+'">'+d+'</h3><ul class="sort-city">'+e[i-65].join("")+"</ul>"),a[i-65]&&(n.push('<li data-key="'+d+'">'+d+"<span>"+d+"</span></li>"),ihotHtmlStr+='<h3 class="city-key-'+d+'">'+d+'</h3><ul class="sort-city">'+a[i-65].join("")+"</ul>");$(".city-wrapper",this.elem).html(s),$(this.elem).append('<ul class="city-nav gcity-nav">'+l.join("")+"</ul>");var u=62;this.dbList&&ihotHtmlStr&&($(".icity-wrapper",this.elem).html(ihotHtmlStr),$(this.elem).append('<ul class="city-nav icity-nav hidden">'+n.join("")+"</ul>"),u+=38),!this.hideNavbar&&(u+=45),$(".city-nav",this.elem).css({top:u+"px"}),1===this.hasLocation&&f.call(this),m.call(this)}}function u(t){for(var e=$.extend({match:[]},t),i=0,a=this.matchAttrs.length;a>i;i++)e.match.push(t[this.matchAttrs[i]]);return e}function f(){var t=this;seajs.use("http://js.40017.cn/touch/hb/c/2/js/h5only/depends/location/3.0.0/location.js",function(){var e=$(".dw-city",this.elem).html('<li class="disabled"><span>正在获取位置信息</span></li>'),i=$.extend({time:!0,useLocal:!1},t.locConfig);i.fn=function(l){function n(){e=$(".dw-city",this.elem).html('<li class="disabled"><span>定位到的城市('+s+")不符合要求</span></li>")}if(i.processFn&&(l=i.processFn(l)),l.tips)e.html('<li class="disabled'+(l.reject?"":" retry")+'"><span>'+l.tips+(l.reject?"":"(点击重试)")+"</span></li>");else{var s=l.cityName.replace("市","");if(t.loc&&$.isPlainObject(t.cities))if("function"==typeof t.loc){var o=t.loc(l);o?e.html(t.buildCityItem(o,"li",'<span style="margin-left:15px;">GPS定位</span>')):n()}else if($.isPlainObject(t.loc)){ajaxObj=$.extend({},t.loc);var r=ajaxObj.processData({cityName:s,latitude:l.latitude,longitude:l.longitude});a(ajaxObj,r),ajaxObj.callback=function(i){if(t.loc.callback&&(i=t.loc.callback(i)),!i||$.isEmptyObject(i))return void n();e.html("");for(var a in i)e.append(t.buildCityItem(i[a],"li",'<span style="margin-left:15px;">GPS定位</span>'))},_tc_bridge_util.get_data(ajaxObj)}else{var c={};c[t.dataAttrMap.id]=l[t.dataAttrMap.id]||l.cityId,c[t.dataAttrMap.name]=l[t.dataAttrMap.name]||l.cityName,e.html(t.buildCityItem(c,"li",'<span style="margin-left:15px;">GPS定位</span>'))}else{var h=[];h=t.dbList?h.concat(t.cities[0]).concat(t.cities[1]):t.cities[0];for(var p=0,d=h.length;d>p;p++)if(h[p][t.nameAttr]===s){e.html(t.buildCityItem(h[p],"li",'<span style="margin-left:15px;">GPS定位</span>'));break}p===h.length&&(nolocadress=!1)}}},$.location(i)})}function m(){var t=this,e=$(".search input",this.elem),i=$(window).height()-(56+(this.dbList&&40)+(!this.hideNavbar&&45))-5;if($(".city-nav",t.elem).delegate("li","click",function(){var e=$(this),i=$((e.parents(".city-nav").hasClass("icity-nav")?".icity-wrapper":".city-wrapper")+" .city-key-"+this.getAttribute("data-key"),t.elem),a=e.parents(".icity-nav")[0]?$(".icity-wrapper",t.elem):$(".city-wrapper",t.elem);try{l.call(a,{toT:i[0].offsetTop})}catch(n){}}).on("touchstart",function(t){var e=t.target,i=e.tagName.toLocaleLowerCase();if("ul"!==i){for(;"li"!==i&&i;)e=e.parentNode;e=$(e),e.hasClass("nav-active")||($(".city-nav li").removeClass("nav-active"),e.addClass("nav-active"))}}).on("touchend",function(t){$(".city-nav li").removeClass("nav-active")}).each(function(t,e){var a=$("li",e),l=a.length,n=i/l;n=15>n?15:n,n=n>35?35:n,a.css({"line-height":n+"px"})}),$(".c-wrapper",this.elem).delegate("li","click ",function(){var e=$(this);e.hasClass("disabled")?(e.hasClass("get-location")||e.hasClass("retry"))&&f.call(t):g.call(t,this)}),this.hasSearch){$(".search-complete",this.elem).on("click",function(i){""===e[0].value&&setTimeout(function(){v.call(t)},300)}),e.on("focus",function(){t.autoComplete&&""===this.value&&t.completeObj.defaultData!==!1&&(t.autoComplete.show(),t.keepCityList||($(".search-complete",this.elem).css({display:"block"}),$(".city-notice, .city-nav",this.elem).addClass("none"))),$(".search",this.elem).removeClass("search-reset")}).val("").trigger("keyup").on("input",function(){""===this.value&&t.keepCityList?($(".city-notice, .city-nav",this.elem).removeClass("none"),$(".search-complete",this.elem).css({display:"none"})):($(".city-notice, .city-nav",this.elem).addClass("none"),$(".search-complete",this.elem).css({display:"block"}))});var a=$(".clear",t.elem).on("click",function(i){$(this).css({display:"none"}),""!==e.val()&&(e.val("").trigger("input"),t.keepCityList?($(".city-notice, .city-nav",t.elem).removeClass("none"),$(".search-complete",t.elem).css({display:"none"})):t.autoComplete.show())});$(".cancel",t.elem).on("click",function(i){e.val(""),v.call(t),a.css({display:"none"})}),b.call(this),this.cityPanelCon&&this.cityPanelCon.each(function(t,e){0===t?$(e).removeClass("none"):$(e).addClass("none")});var n;t.activeCity&&(n=$('.icity-wrapper li[data-name="'+t.activeCity+'"]',t.elem).addClass("select"),("right"===t.tabType||n[0])&&$(".city-tab li",t.elem).eq(1).trigger("click"),$('.city-wrapper li[data-name="'+t.activeCity+'"]',t.elem).addClass("select"))}}function y(t){var e="number"==typeof this.nameAttr?[]:{};for(var i in this.dataAttrMap)e[this.dataAttrMap[i]]=t.getAttribute("data-"+i);e[this.nameAttr]||(e[this.nameAttr]=t.innerHTML);var a=decodeURIComponent(t.getAttribute("data-citycache"));if(a){a=JSON.parse(a);for(var l in a)e[l]=a[l]}return e}function g(t){if(!w){w=!0;var e,i=this,a=y.call(this,t);try{e=JSON.parse(decodeURIComponent($(t).attr("data-citycache")))}catch(l){}this.select&&($(".c-wrapper .select",this.elem).removeClass("select"),$(t).addClass("select"));try{i.fn&&i.fn(a,e)}catch(l){}setTimeout(function(){w=!1,window._fedRouter?$("#"+i.name+"Page").css({display:"none"}):v.call(i);try{_tc_bridge_public.closeRouter(i.name)}catch(t){}_tc_bridge_bar.set_navbar_hidden()},550)}}function b(){var t=this;t.autoComplete=$(".search input",t.elem).autoComplete($.extend({content:$(".search-complete",t.elem),localData:t.completeData,max:10,title:!1,needClose:!1,ajaxObj:{},itemValueFn:function(){return""},itemPrintFn:function(e){return t.buildCityItem(e,"div")},keepListOnNoResult:!1,showClosebtn:!1,selectItemFn:function(e,i){g.call(t,$("div",i)[0])},chooseClass:""},t.completeObj))}function v(){$(".search-complete .autofill-wrap",this.elem).css({display:"none"}),$(".search",this.elem).addClass("search-reset"),$(".city-notice, .city-nav",this.elem).removeClass("none"),$(".search-complete",this.elem).css({display:"none"})}$.city=function(e){if(e.elem){if($(".c-wrapper",e.elem).length)return void(e.select&&($(".c-wrapper .select",e.elem).removeClass("select"),$("li[data-"+e.select[0]+'="'+e.select[1]+'"]',e.elem).addClass("select")))}else if($("#"+(e.name||"city")+"Page .c-wrapper").length)return void(e.select&&($(".c-wrapper .select",e.elem).removeClass("select"),$("li[data-"+e.select[0]+'="'+e.select[1]+'"]',e.elem).addClass("select")));return new t(e)};var x={grid:"hot-city-ul clearfix",line:"sort-city",block:"block-city"};t.prototype.buildCityItem=function(t,e,i){var a=JSON.stringify(t),l="<"+e+' data-citycache="'+encodeURIComponent(a)+'"',n=t[this.nameAttr];for(var s in this.dataAttrMap)l+=" data-"+s+'="'+t[this.dataAttrMap[s]]+'"';return l+=n?">"+n+(i?i:"")+"</"+e+">":' class="disabled">暂无可选城市'+(i?i:"")+"</"+e+">"},t.prototype.getHotCity=function(t,e){if(this.hotCityFilter){var i=this.hotCities;(e||0===e)&&(i=this.hotCities[e]);for(var a=0,l=i.length;l>a;a++)if(this.hotCityFilter(i[a],t)){i[a]=t;break}}},t.prototype.destroy=function(){$(".city-nav",this.elem).undelegate("li","click").off("touchstart").off("touchend"),$(".c-wrapper",this.elem).undelegate("li","click"),$(".search-complete",this.elem).off("click"),$(".search input",this.elem).off("focus").off("input"),$(".clear",this.elem).off("click"),$(".cancel",this.elem).off("click"),this._isCreateElem?this.elem.remove():this.elem.html("")};var w=!1}(),e.city=function(t){var e=$.city(t),i=t.fn;return t.fn=function(e){_tc_bridge_public.closeRouter(t.name),i&&i(e)},_tc_bridge_public.openRouter(t.name),!t.hideNavbar&&_tc_bridge_bar.set_navbar({param:{left:[{tagname:"city_left"}],center:[{tagname:"tag_title",value:t.title||"选择城市"}],right:[]},callback:function(e){"city_left"===e.tagname&&_tc_bridge_public.closeRouter(t.name)}}),e},e.show=function(t,e){$("#cityPage").remove();var i=t.param,a={nameAttr:"cName",activeCity:"",hideNavbar:i.hideNavbar,tabName:[],keepCityList:!0,pyAttr:"cPY",hotCities:[],matchAttrs:["cName","cPY","cPYS"],dataAttrMap:{id:"id",name:"cName"},historyCityName:"citySelectCacheName",historyCityNumber:6,tabType:i.tabType},l=i.cityConfig;void 0!==i.hasLocation&&(a.hasLocation=i.hasLocation),a.dbList=2===l.length?!0:!1,a.tabName[0]=l[0].subTitle,a.dbList&&(a.tabName[1]=l[1].subTitle),a.activeCity=i.sName,l[0].tips&&(a.placeholder=l[0].tips),a.hotCities=s(l);var o=n(l);a.cities=o,a.fn=function(a,l){e(t,{tagname:i.tagname,CBData:{cityInfo:l}})},$.city(a),_tc_bridge_public.openRouter("city"),!i.hideNavbar&&_tc_bridge_bar.set_navbar({param:{left:[{tagname:"city_left"}],center:[{tagname:"tag_title",value:i.title||"选择城市"}],right:[]},callback:function(t){"city_left"===t.tagname&&(_tc_bridge_public.closeRouter("city"),window._fedRouter||a.fn({}))}})}}),function(){function t(){return window.autoCompleteId++}function e(e){function l(t,e){if(e){var i=t.param.reqbody;i?(i="string"==typeof i?JSON.parse(i):i,t.param.reqbody=$.extend(i,e)):t.param.reqbody=e}}function s(){ot&&clearTimeout(ot),ot=setTimeout(function(){if(g.ajaxObj)try{g.ajaxObj.abort()}catch(t){}var i=C.processData({key:O.val()}),a=$.extend({},C,{callback:function(t){var i=C.callback(t)||t;if(g.origin=O.val(),i&&i.length)c(S),o(i,O.val());else{q&&o(),q||y(w);var a=O.val();a.length>it&&(a=a.substring(0,it)+"..."),0==e.title&&k.css({display:"block"}),(e.emptyFn?e.emptyFn():!0)&&c('对不起，找不到：<span class="'+Q+'">'+a+"</span>"),a=null}}});l(a,i),g.ajaxObj=_tc_bridge_util.get_data(a),ot=null},200)}function o(t,e,i){t&&x&&x.call(O,t),L=t;for(var a=[],l=[],n=0,s=t.length;s>n;n++){var o=l.length;l[o]=t[n],(o==D-1||n==t.length-1)&&(a[a.length]=l,l=[])}r(a,e,i)}function r(t,e,i){i=i?i:0;var a,l,s;if(y(w),t[i]&&t[i].length){for(n=0;n<t[i].length;n++)t[i][n]&&(row=w.insertRow(-1),cell=row.insertCell(-1),l=V.call(row,t[i][n],n),row.className=K,l&&(row.className+=" "+W),a=U.call(row,t[i][n],n),a===!1?w.deleteRow(-1):(s=Y.call(row,t[i][n],n))?cell.innerHTML=d(a,e):cell.innerHTML=a);w.index=-1,$(".autofill_item",w).highlight("item-state-hover")}}function c(t){O.setTitle(t)}function h(t,e){var i,a,l,n,s,o,r,c,p,d,u=[],f=e;c=f.length;for(var r=0;c>r;r++){i=f[r],a=i.match,d=a.length,n=-1;for(var p=0;d>p;p++)l=a[p],J&&(l=l.toLowerCase()),(s=l.indexOf(t))>-1&&(-1===n||n>s)&&(n=s,o=l);n>-1&&(A&&A(i,o,n),u[u.length]=i)}return!u.length&&q?(t=t.substr(0,t.length-1),""!==t&&(u=h(t,f)),u.matchFalid=!0):(u.matchLength=t.length,!u.length&&!q),u}function p(t,i){var a;J&&(t=t.toLowerCase()),a=""===t?N:h(t,i),g.origin=t;var l=t;t.length>it&&(l=t.substring(0,it)+"..."),a.length?(R&&a.sort(R),a.matchFalid?(0==e.title&&k.css({display:"block"}),c('对不起，找不到：<span class="'+Q+'">'+l+"</span>")):c(et&&""!=t?t+"，"+S:S),o(a,t.substr(0,a.matchLength),0)):(0==e.title&&k.css({display:"block"}),q||y(w),(e.emptyFn?e.emptyFn():!0)&&c('对不起，找不到：<span class="'+Q+'">'+t+"</span>")),l=null}function d(t,e){if(I&&""!==e){var i=e?e:O.val();i="\\"===i?"\\\\":"["+i+"]";var a=new RegExp(i,"g"+(J?"i":""));return t.replace(/(>|^)([^>^<]+)(<|$)/g,function(t){return t.replace(a,function(t){return'<span class="'+Q+'">'+t+"</span>"})})}return t}function u(t){if(0==e.title&&k.css({display:"block"}),t)var i=(t.target,a(t));var l,n=w,o=b.css("display");if(l=O.val(),""===l){if(rt.css({display:"none"}),O.setTitle(""),O.show(),0===N.length)return void O.hide();p(l,N)}else rt.css({display:"block"}),O.show();if(13===i&&"none"!==o){var r=$("."+K,n);e.submit&&e.submit(O),L[n.index]&&(g.val(G.call(r[n.index],L[n.index],n.index)),e.selectItemFn&&"function"==typeof e.selectItemFn&&e.selectItemFn(g,r[n.index])),O.hide()}else 40===i||38===i?m(i,n,g):13===i&&"none"===o?O.hide():C?s():p(l,j)}function f(t,e,a){if(!t||1!==t[0].nodeType||!e||1!==e[0].nodeType)throw new Error("需要指定输入域和/或及其弹框！");var l,n=$(window).width(),s=($(window).height(),e.width()),o=e.height(),r=t.width(),c=(t.height(),e.offset());if(a&&!i(a))a.x="number"==typeof a.x?a.x:0,a.y="number"==typeof a.y?a.y:0;else var a={x:0,y:0};(l=c.left)>n-c.left&&n-c.left<r?t.css({left:c.left+s-r-a.x+"px"}):t.css({left:c.left+a.x+"px"}),t.css({top:c.top+o+a.y+"px"})}function m(t,e,i){var a=$("."+K,e),l=a.length-1,n=0;if(a.length)switch(a.toggleClass(Z,""),t){case 40:do e.index++;while(a[e.index]&&!$(a[e.index]).hasClass(W));e.index>l?(e.index=-1,i.val(i.origin)):($(a[e.index]).addClass(Z),n=e.index,i.val(G.call(a[e.index],L[n],n)));break;case 38:do e.index--;while(a[e.index]&&!$(a[e.index]).hasClass(W));n=e.index,-1===e.index?i.val(i.origin):e.index<-1?(e.index=l,i.val(G.call(a[e.index],L[e.index],e.index)),$(a[e.index]).addClass(Z)):($(a[e.index]).addClass(Z),i.val(G.call(a[e.index],L[n],n)))}}function y(t){t.index=z;for(var e=$("."+K,t),i=e.length;i-- >0;)t.deleteRow(-1)}var g,b,v,x,w,C,k,_=t(),T='<div id="autoComplete-'+_+'" class="autofill-wrap"><div class="show-title"><span class="autofill-hd-inner"></span><span class="autofill-close"></span></div><table class="autofill-tray" cellpadding="0" cellspacing="0"></table></div>',j=[],N=[],L={},F={x:0,y:0},S="输入中文/拼音",O={},A=null,R=null,P="100%",I=!0,D=999,z=0,q=!1,M="val",H="GET",E="json",J=!0,U=function(){},G=function(){},V=function(){return!0},Y=function(){return!0},B=!1,X="",K="autofill_item",W="enableListRow",Z="autofill-hover",Q="autofill-hili",tt=!1,et=!1,it=10,at=!0,lt="body",nt=!1,st=!1;if(g=e.input?$(e.input):null,!g[0])throw new Error("The relevant element does not exist");lt=e.content?$(e.content):$(lt),b=$(T).appendTo(lt),v=$(".autofill-hd-inner",b),k=$(".show-title",b),w=$(".autofill-tray",b)[0],F.x=void 0!==e.offsetX?e.offsetX:0,F.y=void 0!==e.offsetY?e.offsetY:0,U="function"==typeof e.itemPrintFn?e.itemPrintFn:null,"string"==typeof e.title&&$.trim(e.title).length?(S=e.title,v.html(e.title)):e.title===!1&&(S="",v.html("")),"string"==typeof e.theme&&$.trim(e.theme).length&&(X=e.theme,b.addClass(e.theme)),"string"==typeof e.itemClass&&$.trim(e.itemClass).length&&(K=e.itemClass),"string"==typeof e.highlightClass&&$.trim(e.highlightClass).length&&(Q=e.highlightClass),P=e.width?e.width:P,x=e.processPrintDataFn?e.processPrintDataFn:x,A=e.preSortFn?e.preSortFn:A,D=e.max?e.max:D,R=e.sortFn?e.sortFn:R,q=e.keepListOnNoResult?e.keepListOnNoResult:q,H=e.requestType?e.requestType:H,E=e.dataType?e.dataType:E,U=e.itemPrintFn?e.itemPrintFn:U,V=e.itemEnableFn?e.itemEnableFn:V,G=e.itemValueFn?e.itemValueFn:G,j=e.localData?e.localData:j,N=e.defaultData?e.defaultData:N,Y=e.itemHighlightFn?e.itemHighlightFn:Y,Z=e.chooseClass?e.chooseClass:Z,st=e.showClosebtn===!0?!0:!1,$(".autofill-close",b).css({display:st?"block":"none"}),et=e.showUserInput?e.showUserInput:et,P&&b.css({width:P+"px"}),it=e.maxOverFlowNum?e.maxOverFlowNum:it,M=e.requestValName?e.requestValName:M,C=e.ajaxObj||{},C=$.isEmptyObject(C)?!1:C,b.needClose=e.needClose?e.needClose:nt,tt=e.needPositionWrap?!0:tt,tt&&f(b,g,F),b.css({display:"none"});var ot;g.on("keyup",u),g.on("input",u);var rt=g.parent().children(".clear");return g.on("click focus",function(){0!==N.length&&O.show()}),b.on("touchstart",function(t){b.data("touchtime",(new Date).getTime())}),b.on("touchend",function(t){var i=b.data("touchtime");if(nowTime=(new Date).getTime(),nowTime-i<=300){var a,l,n=t.target,s=w;for(l=$("."+K,s);null!==n;){if(a=$(n),a.hasClass(K)){l.each(function(t,i){return i===n&&$(n).hasClass(W)?(l.toggleClass(Z,""),a.addClass(Z),s.index=t,g.val(G.call(l[s.index],L[s.index],s.index)),e.selectItemFn&&"function"==typeof e.selectItemFn&&e.selectItemFn(g,l[s.index]),!1):void 0}),O.hide();break}n=n.parentNode}}}),st&&$(".autofill-close",b).on("click",function(){O.hide()}),g.on("mousedown",function(){B=!0}),g.on("mouseup",function(){B=!1}),b.on("mousedown",function(){B=!0}),b.on("mouseup",function(){B=!1}),g.on("blur",function(t){setTimeout(function(){B||(O.hide(),B=!1)},0)}),$(window).on("resize orientationchange",function(){O.resetPosition()}),O.macth=function(t){t?p(O.val(),t):p(O.val(),j)},O.hide=function(){b.needClose&&b.css({display:"none"})},O.show=function(){"none"===b.css("display")&&(b.css({display:"block"}),O.resetPosition()),at===!0&&0!==N.length?(e.title!==!1&&O.setTitle(S),o(N,"",0),at=!1):N.reset&&(o(N,"",0),e.title===!1&&O.setTitle(""))},O.setTitle=function(t){v.html(t)},O.resetDefaultData=function(t){N=t?t:[],N.reset=!0},O.val=function(t){return void 0===t?$.trim(g.val()):void g.val(t)},O.resetPosition=function(){tt&&f(b,g,F)},O.localData=j,O.resetlocalData=function(t){j=t},O}function i(t){for(var e in t)return!1;return!0}function a(t){return t=event,t.which?t.which:t.keyCode}!function(){function t(){var l=e.attr("hl-cls");clearTimeout(i),e.removeClass(l).removeAttr("hl-cls"),e=null,a.off("touchend touchmove touchcancel",t)}var e,i,a=$(document);$.fn.highlight=function(l,n){return this.each(function(){var s=$(this);s.css({"-webkit-tap-highlight-color":"rgba(255,255,255,0)"}).off("touchstart.hl"),l&&s.on("touchstart.hl",function(o){var r;e=n?(r=$(o.target).closest(n,this))&&r.length&&r:s,
e&&(e.attr("hl-cls",l),i=setTimeout(function(){e.addClass(l)},100),a.on("touchend touchmove touchcancel",t))})})}}(),window.autoCompleteId=window.autoCompleteId||1,$.autoComplete=function(t){return new e(t)},$.fn.autoComplete=function(t){return t.input=this,new e(t)}}();