!function(){"use strict";angular.module("DataServiceApp",[]).factory("DataService",["$rootScope","$q","errorTips","statusCode",function(a,e,i,t){function n(a,e){if(e&&a){var i,t;for(t in e)i=e[t],o(i)&&o(a[t])?n(a[t],i):a[t]=i;return a}}function r(a){if(!o(a))return!0;for(var e in a)if({}.hasOwnProperty.call(a,e))return!1;return!0}function o(a){return"[object Object]"=={}.toString.call(a)}function p(a){return encodeURIComponent(a)}function s(a){return this instanceof s?(n(this,n({totalPage:null,noNextData:!1,loadingText:"努力加载中",errorType:null,noDataText:"没有更多内容了哦",loadErrorText:"加载失败，请点击重新加载",isBusy:!1,pageInfo:null,apiConfig:{tagname:"",iscache:0},apiParams:{}},a)),void(this.showText=this.loadingText)):new s(a)}return s.prototype={constructor:s,paramsCheck:function(a){if(!o(a))throw new Error("the apiConfig must be an object！");if(r(a))throw new Error("the apiConfig cant be an empty object！");if(!a.serviceName)throw new Error("the serviceName is required！");if(!a.url)throw new Error("the url is required！")},buildParams:function(){var e=this;return e.builtParams={param:{servicename:e.apiConfig.serviceName,requrl:p(e.apiConfig.url),reqbody:"",iscache:e.apiConfig.iscache||"0",tagname:e.apiConfig.tagname||""},callback:function(n){a.$apply(function(){e.isBusy=!1,""===n.CBData&&(e.errorType="3",e.showText=i.CRASH);var r,p;try{r=JSON.parse(n.CBData)}catch(s){r=""}switch(r||(e.errorType="3",e.showText=i.CRASH),p=r.response||"",p||(e.errorType="3",e.showText=i.CRASH),+p.header.rspType){case t.NETWORKNOTON:e.errorType="1",e.showText=i.NOTON;break;case t.NETWORKERROR:e.errorType="2",e.showText=i.ERROR;break;case t.SERVERCRASH:e.errorType="3",e.showText=i.CRASH}if(e.apiConfig.pluginName&&e.apiConfig.actionName)window[e.apiConfig.pluginName][e.apiConfig.actionName]&&window[e.apiConfig.pluginName][e.apiConfig.actionName](p);else if(e.apiConfig.callback&&"function"==typeof e.apiConfig.callback)e.apiConfig.callback(p);else if(e.apiConfig.callback&&"string"==typeof e.apiConfig.callback){for(var c,f=e.apiConfig.callback.split("."),l=0;l<f.length;l++){if(0===l)c=window[f[l]];else{if(!o(c))break;c=c[f[l]]}if(!c)break}("function"==typeof c?c:function(){})(p)}if(e.errorType)return!1;if(e.pageInfo&&p.body&&e.setPageInfo(p.body),e.pageInfo&&null!=e.totalPage&&e.apiParams[e.pageInfo.pageIndexFiled]&&e.apiParams[e.pageInfo.pageIndexFiled]>e.totalPage){e.showText=e.noDataText,e.noNextData=!0;try{a.$digest()}catch(s){}}})}},r(e.apiParams)?"string"==typeof e.apiParams?e.builtParams.param.reqbody=e.apiParams:e.builtParams.param.reqbody="":e.builtParams.param.reqbody=JSON.stringify(e.apiParams).substring(1,JSON.stringify(e.apiParams).length-1),this.builtParams},setPageInfo:function(a){var e=this;a&&a[e.pageInfo.pageInfoFiled]&&(e.totalPage=e.totalPage||a[e.pageInfo.pageInfoFiled][e.pageInfo.totalPageFiled]),e.pageInfo&&e.apiParams[e.pageInfo.pageIndexFiled]&&e.apiParams[e.pageInfo.pageIndexFiled]++},go2Tips:function(a){a?a.indexOf("tcwvcnew")>0||a.indexOf("shouji.17u.cn/internal")>0?window.location.href=a:a.indexOf("&")>0?window.location.href=a+"&tcwvcnew":window.location.href=a+"?tcwvcnew":window.location.href="http://appnew.ly.com/hc/1/views/networkerrortips.html?tcwvcnew"},getData:function(){var e=this;if(e.paramsCheck(e.apiConfig),e.isBusy||e.noNextData)return!1;if(e.pageInfo&&null!=e.totalPage&&e.apiParams[e.pageInfo.pageIndexFiled]&&e.apiParams[e.pageInfo.pageIndexFiled]>e.totalPage){e.showText=e.noDataText,e.noNextData=!0;try{a.$digest()}catch(i){}return!1}e.isBusy=!0,e.errorType=null,e.showText=e.loadingText;try{a.$digest()}catch(i){}window._tc_bridge_util.get_data(e.buildParams())}},s}])}();