!function(){"use strict";angular.module("DataServiceApp",[]).factory("DataService",["$rootScope","$q","errorTips","statusCode",function(a,e,i,n){function t(a,e){if(e&&a){var i,n;for(n in e)i=e[n],r(i)&&r(a[n])?t(a[n],i):a[n]=i;return a}}function o(a){if(!r(a))return!0;for(var e in a)if({}.hasOwnProperty.call(a,e))return!1;return!0}function r(a){return"[object Object]"=={}.toString.call(a)}function p(a){return encodeURIComponent(a)}function s(a){return this instanceof s?(t(this,t({totalPage:null,noNextData:!1,loadingText:"努力加载中",errorType:null,noDataText:"没有更多内容了哦",loadErrorText:"加载失败，请点击重新加载",isBusy:!1,pageInfo:null,apiConfig:{tagname:"",iscache:0},apiParams:{}},a)),void(this.showText=this.loadingText)):new s(a)}return a.safeApply=function(a){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?a&&"function"==typeof a&&a():this.$apply(a)},s.prototype={constructor:s,paramsCheck:function(a){if(!r(a))throw new Error("the apiConfig must be an object！");if(o(a))throw new Error("the apiConfig cant be an empty object！");if(!a.serviceName)throw new Error("the serviceName is required！");if(!a.url)throw new Error("the url is required！")},buildParams:function(){var e=this;return e.builtParams={param:{servicename:e.apiConfig.serviceName,requrl:p(e.apiConfig.url),reqbody:"",iscache:e.apiConfig.iscache||"0",tagname:e.apiConfig.tagname||""},callback:function(t){a.safeApply(function(){e.isBusy=!1,""===t.CBData&&(e.errorType="3",e.showText=i.CRASH);var a,o;try{a=JSON.parse(t.CBData)}catch(p){a=""}switch(a||(e.errorType="3",e.showText=i.CRASH),o=a.response||"",o||(e.errorType="3",e.showText=i.CRASH),+o.header.rspType){case n.NETWORKNOTON:e.errorType="1",e.showText=i.NOTON;break;case n.NETWORKERROR:e.errorType="2",e.showText=i.ERROR;break;case n.SERVERCRASH:e.errorType="3",e.showText=i.CRASH}if(e.apiConfig.pluginName&&e.apiConfig.actionName)window[e.apiConfig.pluginName][e.apiConfig.actionName]&&window[e.apiConfig.pluginName][e.apiConfig.actionName](o,t);else if(e.apiConfig.callback&&"function"==typeof e.apiConfig.callback)e.apiConfig.callback(o,t);else if(e.apiConfig.callback&&"string"==typeof e.apiConfig.callback){for(var s,f=e.apiConfig.callback.split("."),c=0;c<f.length;c++){if(0===c)s=window[f[c]];else{if(!r(s))break;s=s[f[c]]}if(!s)break}("function"==typeof s?s:function(){})(o,t)}return e.errorType?!1:(e.pageInfo&&o.body&&e.setPageInfo(o.body),void(e.pageInfo&&null!=e.totalPage&&e.apiParams[e.pageInfo.pageIndexFiled]&&e.apiParams[e.pageInfo.pageIndexFiled]>e.totalPage&&(e.showText=e.noDataText,e.noNextData=!0)))})}},o(e.apiParams)?"string"==typeof e.apiParams?e.builtParams.param.reqbody=e.apiParams:e.builtParams.param.reqbody="":e.builtParams.param.reqbody=JSON.stringify(e.apiParams).substring(1,JSON.stringify(e.apiParams).length-1),this.builtParams},setPageInfo:function(a){var e=this;a&&a[e.pageInfo.pageInfoFiled]&&(e.totalPage=e.totalPage||a[e.pageInfo.pageInfoFiled][e.pageInfo.totalPageFiled]),e.pageInfo&&e.apiParams[e.pageInfo.pageIndexFiled]&&e.apiParams[e.pageInfo.pageIndexFiled]++},go2Tips:function(a){a?a.indexOf("tcwvcnew")>0||a.indexOf("shouji.17u.cn/internal")>0?window.location.href=a:a.indexOf("&")>0?window.location.href=a+"&tcwvcnew":window.location.href=a+"?tcwvcnew":window.location.href="http://appnew.ly.com/hc/1/views/networkerrortips.html?tcwvcnew"},getData:function(){var e=this;e.paramsCheck(e.apiConfig),a.safeApply(function(){return e.isBusy||e.noNextData?!1:e.pageInfo&&null!=e.totalPage&&e.apiParams[e.pageInfo.pageIndexFiled]&&e.apiParams[e.pageInfo.pageIndexFiled]>e.totalPage?(e.showText=e.noDataText,e.noNextData=!0,!1):(e.isBusy=!0,e.errorType=null,e.showText=e.loadingText,void window._tc_bridge_util.get_data(e.buildParams()))})}},s}])}();