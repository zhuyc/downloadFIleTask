!function(){angular.module("lazyApp",[]).directive("lazy",["$window","$q",function(e,n){function r(e){return e.__uid||(e.__uid=""+ ++u)}function c(e,n){var r=e.getBoundingClientRect();return r.top-document.documentElement.scrollTop-("undefined"==typeof n?600:n)<=document.documentElement.clientHeight?!0:!1}function t(){Object.keys(l).forEach(function(e){var n=l[e],r=n.$scope.preload,t=n.$scope;iElement=n.iElement,c(iElement,r)&&o(iElement,t,n)})}function o(e,n,c){if(c&&!c.isLoading||!c){var t=document.createElement("img"),o=r(e);e=angular.element(e),t.src=e.attr("scsrc"),c&&(c.isLoading=!0),t.onload=function(){t.src===n.scsrc&&(c&&(c.isLoading=!1),i(n,"sc"),s(e[0],t.src),f[t.src]=!0,l.hasOwnProperty(o)&&delete l[o])},t.onerror=function(){t.src===n.scsrc&&(c&&(c.isLoading=!1),s(e[0],e.attr("ersrc")),i(n,"er"))}}}function s(e,n){"img"===e.nodeName.toLowerCase()?e.src=n:e.style.backgroundImage="url("+n+")"}function i(e,n){if(-1==["sc","df","er"].indexOf(n))return void console.log("state赋值错误");e.state=n,e["on"+n]&&e["on"+n]();try{e.$parent.$digest()}catch(r){}}var a=e,d=angular.element(a),u=0,l={},f={};return d.bind("touchmove",t),d.bind("scroll",t),{restrict:"A",scope:{lazy:"@",preload:"@",ersrc:"@",dfsrc:"@",scsrc:"@",wpsrc:"@",nmsrc:"@",onsc:"&",oner:"&",ondf:"&",hasAnimate:"@"},link:function(e,t){function a(){var e=new Image,r=n.defer();return e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=function(){e.width>0&&e.height>0?r.resolve():r.reject()},e.onerror=function(){r.reject()},a=function(){return r.promise},r.promise}e.lazy="false"==e.lazy||0==e.lazy?!1:!0,e.hasAnimate="false"==e.hasAnimate||0==e.hasAnimate?!1:!0,t=t[0];var d=r(t);s(t,e.dfsrc),i(e,"df"),e.preload=e.preload?Number(e.preload):600;var u=[];u[0]=e.$watch("dfsrc",function(){"df"==e.state&&s(t,e.dfsrc)}),u[1]=e.$watch("ersrc",function(){"er"==e.state&&s(t,e.ersrc)}),u[2]=e.$watch("scsrc",function(){return f[e.scsrc]?(i(e,"sc"),void s(t,e.scsrc)):(s(t,e.dfsrc),i(e,"df"),void(e.lazy&&!c(t,e.preload)?l[d]={iElement:t,$scope:e}:o(t,e)))}),a().then(function(){e.wpsrc&&(u[3]=e.$watch("wpsrc",function(){e.scsrc=e.wpsrc}))},function(){e.wpsrc&&(u[3]=e.$watch("nmsrc",function(){e.scsrc=e.nmsrc}))}),e.$on("$destroy",function(){l.hasOwnProperty(d)&&delete l[d],u.forEach(function(e){e()})})}}}])}();