!function(){"use strict";var t=angular.module("starApp",[]);t.service("starService",["$q","$compile","$timeout",function(t,i,n){function a(t,i){if(i&&t){var n,e;for(e in i)n=i[e],"[object Object]"=={}.toString.call(n)&&"[object Object]"=={}.toString.call(t[e])?a(t[e],n):n&&(t[e]=n);return t}}function e(t){if(!(this instanceof e))return new e(t);var i={scope:null,animate:!1,maxCount:5,initCount:0,box:null,callback:null};a(this,a(i,t)),this.tpl='<div class="inner-wrap"><span class="inner-gray"><span class="item" ng-click="starCallback($index)" ng-repeat="item in starData track by $index"></span></span><span class="inner-active" style="{{style}}"><span class="active item" ng-click="starCallback($index)" ng-repeat="item in starData track by $index"></span></span></div>',this.init()}return e.prototype={constructor:e,init:function(){this.checkParams(),this.setActiveStar()},checkParams:function(){if(!this.scope||"[object Object]"!=={}.toString.call(this.scope))throw new Error("scope is required!");if(!this.box||"object"!=typeof this.box)throw new Error("box is required!");(!this.maxCount||isNaN(+this.maxCount)||this.maxCount&&"number"!=typeof+this.maxCount||"number"==typeof+this.maxCount&&+this.maxCount<=0)&&(this.maxCount=5),this.maxCount=+this.maxCount,"string"==typeof this.callback&&{}.hasOwnProperty.call(this.scope.$parent.$$listeners,this.callback)?this.hasEvent=!0:this.hasEvent=!1,(!this.initCount||isNaN(+this.initCount)||this.initCount&&"number"!=typeof+this.initCount||"number"==typeof+this.initCount&&+this.initCount<=0)&&(this.initCount=0),this.initCount=+this.initCount,this.initCount>this.maxCount&&(this.initCount=this.maxCount)},setActiveStar:function(){var t=this;this.box.empty();var a=this.scope;a.starData=new Array(Math.ceil(t.maxCount));var e=i(angular.element(t.tpl))(a);t.box.append(e),t.getWidth(t.initCount).then(function(i){var e="width:"+i+"px";t.animate&&(e+=";-webkit-transition:0.3s linear;transition: 0.3s ease-in-out;",n(function(){a.style=e},0))}),a.starCallback=function(i){t.hasEvent&&t.getWidth(i+1).then(function(n){var e="width:"+n+"px";t.animate&&(e+=";-webkit-transition:0.3s linear;transition: 0.3s ease-in-out;"),a.style=e,t.callback&&a.$emit(t.callback,i)})}},getWidth:function(i){var n=t.defer(),a=0,e=parseInt(i),s=i-e;return setTimeout(function(){var t=$(".inner-gray").find("span");angular.forEach(t,function(t,i){e>i&&(a+=+$(t).width())}),a+=e!==i&&e+1==t.length?t.last().width()*s:t.eq(e).next().width()*s,n.resolve(a)},0),n.promise}},e}]),t.directive("star",["starService",function(t){return{restrict:"EA",replace:!0,scope:{initCount:"@",maxCount:"@"},template:'<span class="star"></span>',link:function(i,n,a){i.$watch("initCount",function(e,s){t({scope:i,box:n,initCount:e,animate:{}.hasOwnProperty.call(a,"animate"),callback:a.callback,maxCount:a.maxCount})})}}}])}();