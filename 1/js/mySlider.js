var sliderApp=angular.module("sliderApp",[]);sliderApp.service("sliderSrv",["$timeout",function(t){function e(t){this.timer,this.myCallback=t.myCallback,this.change=t.change||!1,this.autoPlay=t.autoPlay,this.size=t.scope.myData&&t.scope.myData.length||0,this.width=this.getWinSize().width,this.minleft=-this.width*(this.size+1),this.maxleft=0,this.now_left=0,this.point_x=null,this.point_y=null,this.index=+t.index||0,this.busy=!1,this.playInterval=t.playInterval||3e3,this.scrollTime=500,this.scope=t.scope,this.box=t.box,this.hold=!1,this.dot=t.dot||!1,this.showIndex=t.showIndex||!1,this.init()}return e.prototype={constructor:e,init:function(){var t=this;(t.index>t.size-1||t.index<0)&&(t.index=0),this.checkData.call(this)&&(this.initDots.call(this),t.scope.hasDot=t.dot,t.scope.indexShow=t.showIndex,t.scope.myData.length>1?(this.initLoop.call(this),this.bindEvents.call(this,this.box),t.autoPlay&&this.play.call(this)):t.updateStatus(0),1===t.scope.myData.length&&(this.box.css("transform","translate3d(0,0,0)"),this.box.off()),t.myCallback&&t.scope.$emit(t.myCallback,{index:0}))},checkData:function(){var t=this;return angular.isDefined(t.scope.myData)&&0!=t.scope.myData.length?!0:!1},initDots:function(){var t=this,e=[];if(t.scope.myData&&t.scope.myData.length>1)for(var i=0;i<t.scope.myData.length;i++)e.push(t.scope.myData[i]);t.scope.dotData=e},initLoop:function(){var t=this,e=angular.toJson(t.scope.myData[t.scope.myData.length-1]),i=angular.toJson(t.scope.myData[0]);t.scope.myData.unshift(angular.fromJson(e)),t.scope.myData.push(angular.fromJson(i)),this.now_left=-t.width*(t.index+1),this.minleft=-t.width*t.size,this.maxleft=-t.width,this.updateStatus(t.index),this.box.parent().css({width:t.width+"px"}),this.box.css("width",(t.size+2)*t.width+"px").css(t.getStyle(2))},bindEvents:function(t){var e=this;t.off().on("touchstart",function(t){1!=t.touches.length||e.busy||(e.point_x=t.touches[0].screenX,e.point_y=t.touches[0].screenY,e.hold=!0)}).on("touchmove",function(t){return e.hold=!0,1!=t.touches.length||e.busy?void 0:e.move(t.touches[0].screenX,t.touches[0].screenY,t)}).on("touchend",function(t){e.hold=!1,!e.busy&&e.move_end()})},play:function(){var e=this;return t.cancel(e.timer),e.busy?!1:void(e.timer=t(function(){e.goIndex(e.index+1)},e.playInterval))},goIndex:function(e){if(1==this.scope.dotData.length)return!1;e=+e;var i=this;i.hold||i.busy||(t.cancel(i.timer),i.busy=!0,e=0>e?-1:e,e=e>i.size?i.size:e,i.now_left==-i.width*(e+1)?i.complete(e):(-1==e||e==i.size?(i.index=-1==e?i.size-1:0,i.now_left=-1==e?0:-i.width*(i.size+1)):(i.index=e,i.now_left=-(i.width*(i.index+1))),i.box.css(this.getStyle(1)),t(function(){i.complete(e)},i.scrollTime)),i.updateStatus(e))},updateStatus:function(e){var i=this,n=i.dot,s=i.showIndex;n&&t(function(){angular.forEach(i.scope.carouselCtrl.sliders,function(t,e){t.isSelected=!1}),e>=i.size?i.scope.carouselCtrl.sliders[0]&&(i.scope.carouselCtrl.sliders[0].isSelected=!0):0>e?i.scope.carouselCtrl.sliders[i.size-1]&&(i.scope.carouselCtrl.sliders[i.size-1].isSelected=!0):i.scope.carouselCtrl.sliders[e]&&(i.scope.carouselCtrl.sliders[e].isSelected=!0)}),s&&t(function(){e>=i.size?i.scope.selectedIndex=1:0>e?i.scope.selectedIndex=i.size:i.scope.selectedIndex=e+1})},complete:function(t){var e=this;return e.change?!1:(e.busy=!1,-1==t?e.now_left=e.minleft:t==e.size&&(e.now_left=e.maxleft),e.myCallback&&e.scope.$emit(e.myCallback,{index:e.index}),e.box.css(this.getStyle(2)),void(e.autoPlay&&e.play()))},next:function(){this.busy||this.goIndex(this.index+1)},prev:function(){this.busy||this.goIndex(this.index-1)},move:function(t,e,i){i.preventDefault();var n=t-(null===this.point_x?t:this.point_x),s=e-(null===this.point_y?e:this.point_y),o=this.now_left,l=!1,a=s/Math.sqrt(n*n+s*s);return this.now_left=o+n,this.move_left=0>n,(a>Math.sin(Math.PI/3)||a<-Math.sin(Math.PI/3))&&(l=!0),this.point_x=t,this.point_y=e,this.box.css(this.getStyle(2)),l},move_end:function(){var t=this;t.hold=!1;var e,i=this.now_left%this.width;e=this.now_left<this.minleft?this.index+1:this.now_left>this.maxleft?this.index-1:0!=i?this.move_left?this.index+1:this.index-1:this.index,this.point_x=this.point_y=null,this.goIndex(e)},getStyle:function(t){var e=this.now_left,i=1==t?this.scrollTime:0;return{"-webkit-transition":"-webkit-transform "+i+"ms",transition:"transform "+i+"ms","-webkit-transform-style":"preserve-3d","transform-style":"preserve-3d","-webkit-backface-visibility":"hidden","backface-visibility":"hidden","-webkit-transform":"translate3d("+e+"px,0,0)",transform:"translate3d("+e+"px,0,0)"}},getWinSize:function(){var t,e;return window.innerWidth?t=window.innerWidth:document.body.clientWidth&&(t=document.body.clientWidth),window.innerHeight?e=window.innerHeight:document.body.clientHeight&&(e=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight),{width:t,height:e}}},e}]),sliderApp.directive("myCarousel",["$rootScope","$timeout","sliderSrv","$compile",function(t,e,i,n){return{restrict:"E",replace:!0,scope:{myData:"=",myInterval:"@",myCallback:"@",index:"@",auto:"@",dot:"@",showIndex:"@"},transclude:!0,controllerAs:"carouselCtrl",controller:function(){this.sliders=[],this.addSlider=function(t){this.sliders.push(t)}},template:'<div class="myslider-box"><ul class="myslider-ul" ng-transclude></ul><ol class="myslider-dots" ng-if="hasDot"><li ng-repeat="item in dotData track by $index" ng-click = "mySlider.goIndex($index)" ng-class=\'{true:"active",false:""}[carouselCtrl.sliders[$index].isSelected]\'></li></ol><div class="numRadius" ng-if="indexShow"><span ng-bind="selectedIndex"></span><span>/</span><span ng-bind="dotData.length"></span></div></div>',compile:function(){return{pre:function(t,n,s){var o=s.myInterval,l=s.myCallback||"",a=s.index,c=s.auto||!1,d=s.dot||!1,r=s.showIndex||!1;t.$watch("myData",function(s,h){s!==h&&h&&(e.cancel(t.mySlider.timer),t.mySlider.change=!0,t.carouselCtrl.sliders=[]),t.mySlider=new i({scope:t,dot:d,showIndex:r,box:n.find("ul"),playInterval:o,change:!1,myCallback:l,index:a,autoPlay:c})}),t.$watch("index",function(e,i){e!==i&&i&&t.mySlider.goIndex(e)}),t.$on("$destroy",function(){e.cancel(t.mySlider.timer)})},post:function(t,e,i){}}}}}]),sliderApp.directive("mySlider",["$compile",function(t){return{scope:{},require:"^?myCarousel",restrict:"E",template:'<li class="myslider-li" ng-transclude></li>',replace:!0,transclude:!0,compile:function(){return{pre:function(t,e,i,n){t.isSelected=!1,n.addSlider(t)},post:function(t,e,i,n){}}}}}]);