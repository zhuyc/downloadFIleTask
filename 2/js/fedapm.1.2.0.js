(function(){function e(e){return e&&-1!==e.indexOf("?")?e.split("?")[0]:e}function t(e){switch(e=e.toLowerCase()){case"cmwap":case"ctwap":case"ct_w_a_p":case"uniwap":case"unnet":case"uninet":case"3gprs":e="2g";break;case"cmnet":case"ctnet":case"3gwap":case"3gnet":case"my3g":case"cdma":e="3g";break;case"wwan":e="wifi";break;case"ctlte":e="4g";break;case"non_network":case"n":case"mobile":case"internet":case"vpdn":case"ygj":e="other"}return e}function a(){return-1!=document.location.protocol.indexOf("file")?"http://vstlog.17usoft.com/monitor/__h5hm.gif":"//vstlog.17usoft.com/monitor/__h5hm.gif"}function n(){return!v.options.openTest&&l.test(w)?!0:!1}function o(){window.setTimeout(function(){v.setup()},0)}function r(){return{staType:"monitor",project:v.options.project,t_brs:f,pageName:v.options.pageName,platform:v.platform,ext_domain:d,ext_path:u}}function i(t){t=e(t),t=t.split("/");var a=t.length,n=t[a-1];return n||(n=v.options.project+"/"+v.options.pageName),n}function s(){try{var e,t="other";if(window.ActiveXObject)return"IE";if(window.opr&&opr.addons||window.opera||p.indexOf("opr/")>=0)return"opera";for(var a=[{ua:"qqbrowser",name:"qq"},{ua:"qq/",name:"qqclient"},{ua:"baiduboxapp",name:"baiduboxapp"},{ua:"miuibrowser",name:"miuibrowser"},{ua:"firefox",name:"firefox"},{ua:"baidubrowser",name:"baidu"},{ua:"sogoumobilebrowser",name:"sogou"},{ua:"mxios",name:"maxthon"},{ua:"mxbrowser",name:"maxthon"},{ua:"maxthon",name:"maxthon"},{ua:"ucbrowser",name:"UC"},{ua:"liebaofast",name:"liebao"},{ua:"lbbrowser",name:"liebao"},{ua:"qhbrowser",name:"360"},{ua:"360browser",name:"360"},{ua:"360se",name:"360"},{ua:"androidbrowser",name:"androidbrowser"},{ua:"samsung",name:"samsung"},{ua:"huawei",name:"huawei"},{ua:"vivo",name:"vivo"},{ua:"oppo",name:"oppo"},{ua:"micromessenger",name:"micromessenger"},{ua:"chrome",name:"chrome"},{ua:"safari",name:"safari"}],n=0;n<a.length;n++)if(e=a[n],p.indexOf(e.ua)>-1){t=e.name;break}return t}catch(o){return"other"}}var c=0,m=0,p=window.navigator.userAgent.toLowerCase(),d=encodeURIComponent(document.domain),u=encodeURIComponent(window.location.pathname.toLowerCase().replace(/\//g,"_")),f=s(),w=document.location.hostname,l=/(127[.]0[.]0[.]1)|(localhost)|10(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){3}|172\.([1][6-9]|[2]\d|3[01])(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){2}|192\.168(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){2}/,g=p.indexOf("tctravel")>0,h=p.indexOf("micromessenger")>0,v={options:{url:a(),rate:1,data:{},errStat:0,resTimingStat:0,ajaxTiming:0,pageNameId:"__pageName",projectId:"__projectName",openTest:0,ajaxReqWithOut:4e4},VERSION:"1.2.0",timing:{},data:{},getPageNameAndProjectName:function(){"use strict";try{var e=document.getElementById(v.options.pageNameId||"__pageName"),t=document.getElementById(v.options.projectId||"__projectName");return e=e&&e.value&&(v.options.pageName=e.value)||v.options.pageName,t=t&&t.value&&(v.options.project=t.value)||v.options.project,{pageName:e,project:t}}catch(a){}},check:function(){var e=this.getPageNameAndProjectName();if(e.project&&e.pageName)return v.options.project=e.project,v.options.pageName=e.pageName,window.performance&&window.performance.timing&&Math.random()<v.options.rate;throw new Error("project或pageName不能为空")},setPlatform:function(){if(v.options.platform)return void(this.platform=v.options.platform);var e=/android/.test(p)||/webos/.test(p)||/iphone/.test(p)||/ipad/.test(p)||/ipod/.test(p)||/blackberry/.test(p)||/windows phone/.test(p)||/meego/.test(p),t=/windows/.test(p)||/mac/.test(p),a=/tctravel/.test(p);h?this.platform="wechat":a?this.platform="app":e?this.platform="touch":t?this.platform="pc":this.platform="other"},merge:function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},setup:function(){v.timing=window.performance.timing,v.setData(v.timing)&&v.send(v.data)},getResourceLoadTime:function(){try{var e=[];if("performance"in window&&"getEntriesByType"in window.performance&&window.performance.getEntriesByType("resource")instanceof Array){if(e=window.performance.getEntriesByType("resource"),e.length>0){var t,a,n=[],o=0;if(e.forEach(function(e){t=i(e.name),t&&e.duration>0&&(n.push({perTime:e.duration,perName:t,perType:e.initiatorType||"unknown"}),o+=e.duration)}),n.length>0)return a={resAllTime:o,resCount:n.length,resItem:JSON.stringify(n)}}}else;}catch(r){}},setData:function(e){var t=e.navigationStart||e.fetchStart,a=this,n={t_unload:e.unloadEventEnd-e.unloadEventStart,t_redirect:e.redirectEnd-e.redirectStart,t_dns:e.domainLookupEnd-e.domainLookupStart,t_tcp:e.connectEnd-e.connectStart,t_request:e.responseStart-e.requestStart,t_response:e.responseEnd-e.responseStart,t_paint:v.getFirstPaintTime()-t,t_dom:e.domContentLoadedEventStart-e.domLoading,t_domready:e.domContentLoadedEventStart-t,t_load:e.loadEventStart-e.domLoading,t_onload:e.loadEventStart-t,t_white:e.responseStart-t,t_all:e.loadEventEnd-t};v.options.resTimingStat&&a.getResourceLoadTime()&&v.merge(n,a.getResourceLoadTime());for(var o in n)n.hasOwnProperty(o)&&(n[o]<=0||n[o]>=12e4)&&delete n[o];return v.data=v.merge(n,v.options.data),t>0},getReqServiceName:function(t){var a,n;if("[object Object]"==={}.toString.call(t))n=e(t.servicename||""),a=t.requrl||"",a=e(a);else try{t=JSON.parse(t),n=e(t.servicename||""),a=e(t.requrl||"")}catch(o){}return n||a},processAjax:function(t){var a=this;return function(){var n=[].slice.call(arguments),o=n[0],r=o.beforeSend,i=o.complete,s=o.url,p=o.data||{};return s=e(a.getReqServiceName(p)||s),o.beforeSend=function(){c=+new Date,r&&r.call()},o.complete=function(){var e,t=[].slice.call(arguments),a=null;if(m=+new Date,e=m-c,s&&e>0&&e<=v.options.ajaxReqWithOut){if(t[0]&&t[0].status)try{a=t[0].status.toString()}catch(n){}var o={interfaceUrl:s.replace(/:/gi,"@"),interfaceTime:e,interfaceStatus:a||"-40017"};v.send(o)}i&&i.apply(this,t)},t.apply(this,n)}},rewriteAjax:function(){try{var e,t=this;window.$&&window.$.ajax&&(e=$.ajax,$.ajax=t.processAjax(e)),window.fish&&window.fish.ajax&&(e=fish.ajax,fish.ajax=t.processAjax(e))}catch(a){}},getFirstPaintTime:function(){var e=0;return window.chrome&&"function"==typeof window.chrome.loadTimes?e=1e3*window.chrome.loadTimes().firstPaintTime:"number"==typeof v.timing.msFirstPaint&&(e=v.timing.msFirstPaint),Math.round(e)},send:function(e){var a=v.options.url;if(a){var n,o,i=new Image,s=[],c=r();e=this.merge(c,e||{});for(var m in e)e.hasOwnProperty(m)&&e[m]&&("[object Array]"===Object.prototype.toString.call(e[m])&&(e[m]=JSON.stringify(e[m])),s.push(m+"="+encodeURIComponent(e[m])));if(n=a+(a.indexOf("?")<0?"?":"&")+s.join("&"),g)window._tc_bridge_util&&window._tc_bridge_util.get_network_type({param:{},callback:function(e){if(e.CBData){try{o=t(JSON.parse(e.CBData).networkType)}catch(a){o=""}o&&(n+="&networktype="+o),i.src=n+"&rnd="+ +new Date}}});else if(h)try{var d=p.match(/(nettype\/(\w)+)(?=\s)/);d&&d.length>0&&d[0].indexOf("/")>0&&(o=t(d[0].split("/")[1])),o&&(n+="&networktype="+o),i.src=n+"&rnd="+ +new Date}catch(u){}else i.src=n+"&rnd="+ +new Date}},bindEvents:function(){window.onerror=function(e,t,a,n,o){if(t){var r={errFile:i(t).replace(/:/gi,"@")};v.send({errMsg:JSON.stringify(r)})}}},start:function(e){v.options=v.merge(v.options,e),n()||(this.setPlatform(),v.options.errStat&&this.bindEvents(),v.options.ajaxTiming&&this.rewriteAjax(),v.check()?window.performance.timing.loadEventEnd>0?v.setup():window.addEventListener&&window.addEventListener("load",o,!1):v.send())}};window.fedApm=v}).call(this);